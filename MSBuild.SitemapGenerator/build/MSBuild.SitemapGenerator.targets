<Project>
  <UsingTask TaskName="MSBuild.SitemapGenerator.GenerateSitemap" AssemblyFile="$(MSBuildThisFileDirectory)../lib/netstandard2.0/MSBuild.SitemapGenerator.dll" />

  <Target Name="GenerateSitemapAfterPublish" AfterTargets="Publish;AfterPublish" DependsOnTargets="$(SitemapDependsOnTargets)">
    <PropertyGroup>
      <RelativeWwwRootPath Condition="'$(RelativeWwwRootPath)' == ''">wwwroot</RelativeWwwRootPath>
    </PropertyGroup>

    <ItemGroup>
      <_SitemapRules Include="@(SitemapRule)" />
    </ItemGroup>

    <Error Condition="'$(SitemapBaseUrl)' == ''" Text="SitemapBaseUrl must be specified in the project file." />

    <Message Importance="High" Text="Running MSBuild.SitemapGenerator task... SearchPath: '$(PublishDir)$(RelativeWwwRootPath)/', DependsOnTargets: '$(SitemapDependsOnTargets)'" />
    <GenerateSitemap PublishDir="$(PublishDir)$(RelativeWwwRootPath)/" BaseUrl="$(SitemapBaseUrl)" Rules="@(_SitemapRules)" />
  </Target>
</Project>

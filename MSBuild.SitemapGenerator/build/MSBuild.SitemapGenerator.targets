<Project>
  <UsingTask TaskName="MSBuild.SitemapGenerator.GenerateSitemap" AssemblyFile="$(MSBuildThisFileDirectory)../lib/netstandard2.0/MSBuild.SitemapGenerator.dll" />

  <Target Name="GenerateSitemapAfterPublish" AfterTargets="Publish">
    <PropertyGroup>
      <RelativeWwwRootPath Condition="'$(RelativeWwwRootPath)' == ''">wwwroot</RelativeWwwRootPath>
    </PropertyGroup>

    <ItemGroup>
      <_SitemapRules Include="@(SitemapRule)" />
    </ItemGroup>

    <Error Condition="'$(SitemapBaseUrl)' == ''" Text="SitemapBaseUrl must be specified in the project file." />

    <Message Importance="High" Text="Running GenerateSitemap task... PublishDir: '$(PublishDir)$(RelativeWwwRootPath)/', BaseUrl: '$(SitemapBaseUrl)'" />
    <GenerateSitemap PublishDir="$(PublishDir)$(RelativeWwwRootPath)/" BaseUrl="$(SitemapBaseUrl)" Rules="@(_SitemapRules)" />
  </Target>
</Project>
